diff -r 8e41d25d7665 openjdk/control/make/make/hotspot-rules.gmk
--- openjdk/control/make/make/hotspot-rules.gmk	Fri Jun 20 13:26:10 2008 +0100
+++ openjdk/control/make/make/hotspot-rules.gmk	Fri Jun 20 13:26:20 2008 +0100
@@ -75,6 +75,9 @@ ifdef ICEDTEA_CORE_BUILD
 ifdef ICEDTEA_CORE_BUILD
   HOTSPOT_TARGET := $(HOTSPOT_TARGET)core
 endif
+ifdef ICEDTEA_SHARK_BUILD
+  HOTSPOT_TARGET := $(HOTSPOT_TARGET)shark
+endif
 
 HOTSPOT_BUILD_ARGUMENTS += $(COMMON_BUILD_ARGUMENTS)
 HOTSPOT_BUILD_ARGUMENTS += ALT_OUTPUTDIR=$(HOTSPOT_OUTPUTDIR)
diff -r 8e41d25d7665 openjdk/hotspot/build/linux/Makefile
--- openjdk/hotspot/build/linux/Makefile	Fri Jun 20 13:26:10 2008 +0100
+++ openjdk/hotspot/build/linux/Makefile	Fri Jun 20 13:26:20 2008 +0100
@@ -152,6 +152,13 @@ endif
 #       profiledcore    core            <os>_<arch>_core/profiled
 #       productcore     core            <os>_<arch>_core/product
 #
+#       debugshark      shark           <os>_<arch>_shark/debug
+#       fastdebugshark  shark           <os>_<arch>_shark/fastdebug
+#       jvmgshark       shark           <os>_<arch>_shark/jvmg
+#       optimizedshark  shark           <os>_<arch>_shark/optimized
+#       profiledshark   shark           <os>_<arch>_shark/profiled
+#       productshark    shark           <os>_<arch>_shark/product
+#
 # What you get with each target:
 #
 # debug*     - "thin" libjvm_g - debug info linked into the gamma_g launcher
@@ -172,11 +179,13 @@ SUBDIRS_C2        = $(addprefix $(OSNAME
 SUBDIRS_C2        = $(addprefix $(OSNAME)_$(BUILDARCH)_compiler2/,$(TARGETS))
 SUBDIRS_TIERED    = $(addprefix $(OSNAME)_$(BUILDARCH)_tiered/,$(TARGETS))
 SUBDIRS_CORE      = $(addprefix $(OSNAME)_$(BUILDARCH)_core/,$(TARGETS))
+SUBDIRS_SHARK     = $(addprefix $(OSNAME)_$(BUILDARCH)_shark/,$(TARGETS))
 
 TARGETS_C2        = $(TARGETS)
 TARGETS_C1        = $(addsuffix 1,$(TARGETS))
 TARGETS_TIERED    = $(addsuffix tiered,$(TARGETS))
 TARGETS_CORE      = $(addsuffix core,$(TARGETS))
+TARGETS_SHARK     = $(addsuffix shark,$(TARGETS))
 
 BUILDTREE_MAKE    = $(GAMMADIR)/build/$(OSNAME)/makefiles/buildtree.make
 BUILDTREE_VARS    = GAMMADIR=$(GAMMADIR) OS_FAMILY=$(OSNAME) ARCH=$(SRCARCH) BUILDARCH=$(BUILDARCH) LIBARCH=$(LIBARCH)
@@ -190,6 +199,7 @@ all:
 	@echo "  $(TARGETS_C2)"
 	@echo "  $(TARGETS_C1)"
 	@echo "  $(TARGETS_CORE)"
+	@echo "  $(TARGETS_SHARK)"
 
 checks: check_os_version check_j2se_version
 
@@ -239,6 +249,10 @@ endif
 	$(QUIETLY) $(MAKE) -f $(GAMMADIR)/build/$(OSNAME)/Makefile checks
 	$(BUILDTREE) VARIANT=core
 
+$(SUBDIRS_SHARK): $(BUILDTREE_MAKE)
+	$(QUIETLY) $(MAKE) -f $(GAMMADIR)/build/$(OSNAME)/Makefile checks
+	$(BUILDTREE) VARIANT=shark
+
 # Define INSTALL=y at command line to automatically copy JVM into JAVA_HOME
 
 $(TARGETS_C2):  $(SUBDIRS_C2)
@@ -267,6 +281,12 @@ endif
 	cd $(OSNAME)_$(BUILDARCH)_core/$(patsubst %core,%,$@) && ./test_gamma
 ifdef INSTALL
 	cd $(OSNAME)_$(BUILDARCH)_core/$(patsubst %core,%,$@) && $(MAKE) $(MFLAGS) install
+endif
+
+$(TARGETS_SHARK):  $(SUBDIRS_SHARK)
+	cd $(OSNAME)_$(BUILDARCH)_shark/$(patsubst %shark,%,$@) && $(MAKE) $(MFLAGS)
+ifdef INSTALL
+	cd $(OSNAME)_$(BUILDARCH)_shark/$(patsubst %shark,%,$@) && $(MAKE) $(MFLAGS) install
 endif
 
 # Just build the tree, and nothing else:
@@ -299,7 +319,7 @@ include $(GAMMADIR)/build/$(OSNAME)/make
 
 #-------------------------------------------------------------------------------
 
-.PHONY: $(TARGETS_C2) $(TARGETS_C1) $(TARGETS_CORE)
+.PHONY: $(TARGETS_C2) $(TARGETS_C1) $(TARGETS_CORE) $(TARGETS_SHARK)
 .PHONY: tree tree1 treecore
 .PHONY: all compiler1 compiler2 core
 .PHONY: clean clean_compiler1 clean_compiler2 clean_core docs clean_docs
diff -r 8e41d25d7665 openjdk/hotspot/build/linux/makefiles/buildtree.make
--- openjdk/hotspot/build/linux/makefiles/buildtree.make	Fri Jun 20 13:26:10 2008 +0100
+++ openjdk/hotspot/build/linux/makefiles/buildtree.make	Fri Jun 20 13:26:20 2008 +0100
@@ -171,8 +171,8 @@ flags_vm.make: $(BUILDTREE_MAKE) ../shar
 
 ../shared_dirs.lst:  $(BUILDTREE_MAKE) $(GAMMADIR)/src/share/vm
 	@echo Creating directory list $@
-	$(QUIETLY) find $(GAMMADIR)/src/share/vm/* -prune \
-	-type d \! \( $(TOPLEVEL_EXCLUDE_DIRS) \) -exec find {} \
+	$(QUIETLY) find -L $(GAMMADIR)/src/share/vm/* -prune \
+	-type d \! \( $(TOPLEVEL_EXCLUDE_DIRS) \) -exec find -L {} \
         \( $(ALWAYS_EXCLUDE_DIRS) \) -prune -o -type d -print \; > $@
 
 Makefile: $(BUILDTREE_MAKE)
diff -r 8e41d25d7665 openjdk/hotspot/build/linux/makefiles/defs.make
--- openjdk/hotspot/build/linux/makefiles/defs.make	Fri Jun 20 13:26:10 2008 +0100
+++ openjdk/hotspot/build/linux/makefiles/defs.make	Fri Jun 20 13:26:39 2008 +0100
@@ -118,6 +118,7 @@ EXPORT_LIST += $(EXPORT_SERVER_DIR)/libj
 EXPORT_LIST += $(EXPORT_SERVER_DIR)/libjsig.so
 EXPORT_LIST += $(EXPORT_SERVER_DIR)/libjvm.so
 ifndef ICEDTEA_CORE_BUILD
+ifndef ICEDTEA_SHARK_BUILD
 ifeq ($(ARCH_DATA_MODEL), 32)
   EXPORT_CLIENT_DIR = $(EXPORT_JRE_LIB_ARCH_DIR)/client
   EXPORT_LIST += $(EXPORT_CLIENT_DIR)/Xusage.txt
@@ -133,3 +134,4 @@ else
     endif
 endif
 endif
+endif
diff -r 8e41d25d7665 openjdk/hotspot/build/linux/makefiles/gcc.make
--- openjdk/hotspot/build/linux/makefiles/gcc.make	Fri Jun 20 13:26:10 2008 +0100
+++ openjdk/hotspot/build/linux/makefiles/gcc.make	Fri Jun 20 13:26:20 2008 +0100
@@ -63,6 +63,9 @@ VM_PICFLAG        = $(VM_PICFLAG/$(LINK_
 
 ifdef ICEDTEA_ZERO_BUILD
 CFLAGS += $(LIBFFI_CFLAGS)
+endif
+ifdef ICEDTEA_SHARK_BUILD
+CFLAGS += $(LLVM_CFLAGS)
 endif
 CFLAGS += $(VM_PICFLAG)
 CFLAGS += -fno-rtti
diff -r 8e41d25d7665 openjdk/hotspot/build/linux/makefiles/top.make
--- openjdk/hotspot/build/linux/makefiles/top.make	Fri Jun 20 13:26:10 2008 +0100
+++ openjdk/hotspot/build/linux/makefiles/top.make	Fri Jun 20 13:26:20 2008 +0100
@@ -71,6 +71,7 @@ Include_DBs/COMPILER1   = $(Include_DBs/
 Include_DBs/COMPILER1   = $(Include_DBs/CORE) $(VM)/includeDB_compiler1
 Include_DBs/COMPILER2   = $(Include_DBs/CORE) $(VM)/includeDB_compiler2
 Include_DBs/TIERED      = $(Include_DBs/CORE) $(VM)/includeDB_compiler1 $(VM)/includeDB_compiler2
+Include_DBs/SHARK       = $(Include_DBs/CORE) $(VM)/includeDB_shark
 Include_DBs = $(Include_DBs/$(TYPE))
 
 Cached_plat = $(GENERATED)/platform.current
diff -r 8e41d25d7665 openjdk/hotspot/build/linux/makefiles/vm.make
--- openjdk/hotspot/build/linux/makefiles/vm.make	Fri Jun 20 13:26:10 2008 +0100
+++ openjdk/hotspot/build/linux/makefiles/vm.make	Fri Jun 20 13:26:20 2008 +0100
@@ -149,10 +149,14 @@ mapfile_reorder : mapfile $(REORDERFILE)
 	rm -f $@
 	cat $^ > $@
 
-ifeq ($(ZERO_LIBARCH), ppc64)
+ifdef ICEDTEA_SHARK_BUILD
   STATIC_CXX = false
 else
-  STATIC_CXX = true
+  ifeq ($(ZERO_LIBARCH), ppc64)
+    STATIC_CXX = false
+  else
+    STATIC_CXX = true
+  endif
 endif
 
 ifeq ($(LINK_INTO),AOUT)
@@ -179,6 +183,10 @@ endif
 endif
 ifdef ICEDTEA_ZERO_BUILD
 LIBS_VM += $(LIBFFI_LIBS)
+endif
+ifdef ICEDTEA_SHARK_BUILD
+LFLAGS_VM += $(LLVM_LDFLAGS)
+LIBS_VM   += $(LLVM_LIBS)
 endif
 
 LINK_VM = $(LINK_LIB.c)
diff -r 8e41d25d7665 openjdk/hotspot/make/Makefile
--- openjdk/hotspot/make/Makefile	Fri Jun 20 13:26:10 2008 +0100
+++ openjdk/hotspot/make/Makefile	Fri Jun 20 13:30:28 2008 +0100
@@ -99,6 +99,15 @@ all_debugcore:     jvmgcore docs export_
 all_debugcore:     jvmgcore docs export_debug
 all_optimizedcore: optimizedcore docs export_optimized
 
+# Shark (C0) targets made available with this Makefile
+SHARK_VM_TARGETS=productshark fastdebugshark optimizedshark jvmgshark
+
+allshark:           all_productshark all_fastdebugshark
+all_productshark:   productshark docs export_product
+all_fastdebugshark: fastdebugshark docs export_fastdebug
+all_debugshark:     jvmgshark docs export_debug
+all_optimizedshark: optimizedshark docs export_optimized
+
 # Do everything
 world:         all create_jdk
 
@@ -124,6 +133,10 @@ endif
 $(CORE_VM_TARGETS):
 	$(CD) $(GAMMADIR)/make; \
 	$(MAKE) VM_TARGET=$@ generic_buildcore $(ALT_OUT)
+
+$(SHARK_VM_TARGETS):
+	$(CD) $(GAMMADIR)/make; \
+	$(MAKE) VM_TARGET=$@ generic_buildshark $(ALT_OUT)
 
 # Build compiler1 (client) rule, different for platforms
 generic_build1:
@@ -172,6 +185,12 @@ generic_buildcore:
 	$(CD) $(OUTPUTDIR); \
 		$(MAKE) -f $(ABS_OS_MAKEFILE) \
 			$(MAKE_ARGS) $(VM_TARGET)
+
+generic_buildshark:
+	$(MKDIR) -p $(OUTPUTDIR)
+	$(CD) $(OUTPUTDIR); \
+		$(MAKE) -f $(ABS_OS_MAKEFILE) \
+			$(MAKE_ARGS) $(VM_TARGET) 
 
 # Export file rule
 generic_export: $(EXPORT_LIST)
@@ -204,7 +223,11 @@ ifdef ICEDTEA_CORE_BUILD
 ifdef ICEDTEA_CORE_BUILD
 C2_BASE_DIR=$(OUTPUTDIR)/$(VM_PLATFORM)_core
 else
+ifdef ICEDTEA_SHARK_BUILD
+C2_BASE_DIR=$(OUTPUTDIR)/$(VM_PLATFORM)_shark
+else
 C2_BASE_DIR=$(OUTPUTDIR)/$(VM_PLATFORM)_compiler2
+endif
 endif
 C1_DIR=$(C1_BASE_DIR)/$(VM_SUBDIR)
 C2_DIR=$(C2_BASE_DIR)/$(VM_SUBDIR)
@@ -214,6 +237,10 @@ ifdef ICEDTEA_CORE_BUILD
   MISC_DIR=$(C2_DIR)
   GEN_DIR=$(C2_BASE_DIR)/generated
 else
+ifdef ICEDTEA_SHARK_BUILD
+  MISC_DIR=$(C2_DIR)
+  GEN_DIR=$(C2_BASE_DIR)/generated
+else
 ifeq ($(ARCH_DATA_MODEL), 32)
   MISC_DIR=$(C1_DIR)
   GEN_DIR=$(C1_BASE_DIR)/generated
@@ -222,6 +249,7 @@ else
   GEN_DIR=$(C2_BASE_DIR)/generated
 endif
 endif
+endif
 
 # Bin files (windows)
 ifeq ($(OSNAME),windows)
diff -r 8e41d25d7665 openjdk/jdk/make/java/redist/Makefile
--- openjdk/jdk/make/java/redist/Makefile	Fri Jun 20 13:26:10 2008 +0100
+++ openjdk/jdk/make/java/redist/Makefile	Fri Jun 20 13:28:19 2008 +0100
@@ -96,9 +96,11 @@ endif # INCLUDE_SA
 
 # Hotspot client is only available on 32-bit builds
 ifndef ICEDTEA_CORE_BUILD
+ifndef ICEDTEA_SHARK_BUILD
 ifeq ($(ARCH_DATA_MODEL), 32)
   IMPORT_LIST += $(LIB_LOCATION)/$(CLIENT_LOCATION)/$(JVM_NAME) \
                  $(LIB_LOCATION)/$(CLIENT_LOCATION)/Xusage.txt
+endif
 endif
 endif
 
@@ -164,6 +166,7 @@ endif
 endif 
 
 ifndef ICEDTEA_CORE_BUILD
+ifndef ICEDTEA_SHARK_BUILD
 ifeq ($(ARCH_DATA_MODEL), 32)
 
 IMPORT_LIST += $(LIB_LOCATION)/$(CLIENT_LOCATION)/$(LIBJSIG_NAME)
@@ -193,6 +196,8 @@ endif # 32bit solaris
 endif # 32bit solaris
 
 endif # 32bit
+
+endif # ICEDTEA_SHARK_BUILD
 
 endif # ICEDTEA_CORE_BUILD
 
